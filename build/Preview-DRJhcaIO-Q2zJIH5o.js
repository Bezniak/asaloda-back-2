import{cw as v,j as e,cx as y,cy as P,bo as f,v as j,P as u,B as g,cA as k,u as m,aP as x,r as C,cE as B,cv as L,ey as M,cB as T,cC as D,o as E,bE as F,F as h,T as w,I as b,dI as I,aq as R,ez as p,bx as H,b8 as N,bW as S}from"./strapi-B61x8no8.js";import{getDocumentStatus as A}from"./EditViewPage-hiwZg61J-b64XoGnX.js";import"./Field-BQQLwyUs-B-EHuCWE.js";import"./Relations-DGWa9W2j-Di8JkfHL.js";import"./useDragAndDrop-DdHgKsqq-j5zCJx9h.js";import"./relations-C8eyDiIO-fIcneq73.js";import"./getEmptyImage-CjqolaH3.js";import"./ComponentIcon-u4bIXTFY-Djnnj5zp.js";import"./objects-D6yBsdmx-C4s7dVQY.js";import"./useDebounce-DmuSJIF3-DeTi4T62.js";const q=()=>{const[{query:a}]=x(),n=R(),{formatMessage:i}=m(),r=p("BackButton",o=>o.canGoBack),c=p("BackButton",o=>o.goBack),d=p("BackButton",o=>o.history),s={pathname:"..",search:H.stringify(a,{encode:!1})},t=o=>{o.preventDefault(),r?c():n(s)};return e.jsx(b,{tag:N,to:d.at(-1)??s,onClick:t,label:i({id:"content-manager.preview.header.close",defaultMessage:"Close preview"}),children:e.jsx(S,{})})},z=a=>{switch(a){case"draft":return{background:"secondary100",border:"secondary200",text:"secondary700",message:{id:"content-manager.containers.List.draft",defaultMessage:"Draft"}};case"modified":return{background:"alternative100",border:"alternative200",text:"alternative700",message:{id:"content-manager.containers.List.modified",defaultMessage:"Modified"}};case"published":default:return{background:"success100",border:"success200",text:"success700",message:{id:"content-manager.containers.List.published",defaultMessage:"Published"}}}},W=()=>{const{formatMessage:a}=m(),n=l("PreviewHeader",t=>t.document),i=l("PreviewHeader",t=>t.schema),r=l("PreviewHeader",t=>t.meta),c=i?.options?.draftAndPublish??!1,d=A(n,r),s=z(d);return c?e.jsx(g,{background:s.background,borderStyle:"solid",borderWidth:"1px",borderColor:s.border,hasRadius:!0,paddingLeft:"6px",paddingRight:"6px",paddingTop:"2px",paddingBottom:"2px",children:e.jsx(w,{variant:"pi",fontWeight:"bold",textColor:s.text,children:a(s.message)})}):null},G=()=>{const a=l("PreviewHeader",t=>t.mainField),i=l("PreviewHeader",t=>t.document)[a],{formatMessage:r}=m(),{toggleNotification:c}=E(),{copy:d}=F(),s=()=>{d(window.location.href),c({message:r({id:"content-manager.preview.copy.success",defaultMessage:"Copied preview link"}),type:"success"})};return e.jsxs(h,{justifyContent:"space-between",background:"neutral0",padding:2,borderColor:"neutral150",tag:"header",children:[e.jsxs(h,{gap:3,children:[e.jsx(q,{}),e.jsx(w,{tag:"h1",fontWeight:600,fontSize:2,children:i}),e.jsx(W,{})]}),e.jsx(b,{type:"button",label:r({id:"preview.copy.label",defaultMessage:"Copy preview link"}),onClick:s,children:e.jsx(I,{})})]})},[U,l]=v("PreviewPage"),$=()=>{const{formatMessage:a}=m(),{slug:n,id:i,collectionType:r}=f(),[{query:c}]=x(),d=C.useMemo(()=>B(c),[c]);if(!r)throw new Error("Could not find collectionType in url params");if(!n)throw new Error("Could not find model in url params");if(r===L&&!i)throw new Error("Could not find documentId in url params");const s=M({params:{contentType:n},query:{documentId:i,locale:d.locale,status:d.status}}),t=T({model:n,collectionType:r,documentId:i,params:d}),o=D(n);return t.isLoading||s.isLoading||o.isLoading?e.jsx(u.Loading,{}):s.error||o.error||!t.document||!t.meta||!t.schema?e.jsx(u.Error,{}):s.data?.data?.url?e.jsxs(e.Fragment,{children:[e.jsx(u.Title,{children:a({id:"content-manager.preview.page-title",defaultMessage:"{contentType} preview"},{contentType:o.edit.settings.displayName})}),e.jsx(U,{url:s.data.data.url,mainField:o.edit.settings.mainField,document:t.document,meta:t.meta,schema:t.schema,children:e.jsx(G,{})})]}):e.jsx(u.NoData,{})},O=()=>{const{slug:a}=f(),{permissions:n=[],isLoading:i,error:r}=j([{action:"plugin::content-manager.explorer.read",subject:a}]);return i?e.jsx(u.Loading,{}):r||!a?e.jsx(g,{height:"100vh",width:"100vw",position:"fixed",top:0,left:0,zIndex:2,background:"neutral0",children:e.jsx(u.Error,{})}):e.jsx(g,{height:"100vh",width:"100vw",position:"fixed",top:0,left:0,zIndex:2,background:"neutral0",children:e.jsx(u.Protect,{permissions:n,children:({permissions:c})=>e.jsx(k,{permissions:c,children:e.jsx($,{})})})})},se=()=>e.jsx(y,{children:e.jsx(P,{children:e.jsx(O,{})})});export{se as ProtectedPreviewPage,l as usePreviewContext};
